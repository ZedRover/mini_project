# æ•°æ®æ³„éœ²ä¿®å¤ä¸é‡æ–°è¿è¡ŒæŒ‡å—

**æ—¥æœŸ**: 2025-11-10
**çŠ¶æ€**: âœ… ä»£ç å·²ä¿®å¤ï¼Œç­‰å¾…é‡æ–°è¿è¡Œå®éªŒ

---

## ä¿®å¤å†…å®¹æ€»ç»“

### å·²ä¿®å¤çš„æ–‡ä»¶

| æ–‡ä»¶ | ä¿®æ”¹å†…å®¹ |
|------|---------|
| `src/s01_data_analysis/data_loader.py` | æ·»åŠ `use_time_series_split`å‚æ•°ï¼Œé»˜è®¤ä½¿ç”¨æ—¶åºåˆ’åˆ† |
| `src/utils/cross_validation.py` | æ·»åŠ `use_time_series_split`å‚æ•°ï¼Œé»˜è®¤ä½¿ç”¨TimeSeriesSplit |

### å…³é”®å˜æ›´

#### 1. DataLoader (data_loader.py)

**æ–°å¢å‚æ•°**:
```python
DataLoader(
    data_path="data/data.csv",
    target_column="realY",
    test_size=0.2,
    random_state=42,
    use_time_series_split=True  # ğŸ†• æ–°å¢ï¼Œé»˜è®¤True
)
```

**åˆ’åˆ†æ–¹å¼å¯¹æ¯”**:
```python
# âŒ æ—§æ–¹å¼ï¼ˆéšæœºåˆ’åˆ†ï¼Œå¯¼è‡´æ•°æ®æ³„éœ²ï¼‰
use_time_series_split=False
â†’ è®­ç»ƒé›†ç´¢å¼•: [1, 2, 4, 5, 6, 7, 9, 11, ...]  # æ··æ‚
â†’ æµ‹è¯•é›†ç´¢å¼•: [0, 3, 8, 10, 12, 14, ...]      # æ··æ‚

# âœ… æ–°æ–¹å¼ï¼ˆæ—¶åºåˆ’åˆ†ï¼Œé˜²æ­¢æ•°æ®æ³„éœ²ï¼‰
use_time_series_split=True
â†’ è®­ç»ƒé›†ç´¢å¼•: [0, 1, 2, ..., 7999]   # å‰80%
â†’ æµ‹è¯•é›†ç´¢å¼•: [8000, 8001, ..., 9999]  # å20%
```

#### 2. CrossValidator (cross_validation.py)

**æ–°å¢å‚æ•°**:
```python
CrossValidator(
    n_folds=4,
    random_state=42,
    shuffle=True,  # ä»…åœ¨use_time_series_split=Falseæ—¶æœ‰æ•ˆ
    use_time_series_split=True  # ğŸ†• æ–°å¢ï¼Œé»˜è®¤True
)
```

**äº¤å‰éªŒè¯æ–¹å¼å¯¹æ¯”**:
```python
# âŒ æ—§æ–¹å¼ï¼ˆKFold with shuffleï¼Œå¯¼è‡´æ•°æ®æ³„éœ²ï¼‰
use_time_series_split=False
â†’ KFold(n_splits=4, shuffle=True)
â†’ æ¯ä¸ªfoldçš„è®­ç»ƒ/éªŒè¯é›†åœ¨æ—¶é—´ä¸Šæ··åˆ

# âœ… æ–°æ–¹å¼ï¼ˆTimeSeriesSplitï¼Œé˜²æ­¢æ•°æ®æ³„éœ²ï¼‰
use_time_series_split=True
â†’ TimeSeriesSplit(n_splits=4)
â†’ Fold 1: è®­ç»ƒ[0:2000], éªŒè¯[2000:4000]
â†’ Fold 2: è®­ç»ƒ[0:4000], éªŒè¯[4000:6000]
â†’ Fold 3: è®­ç»ƒ[0:6000], éªŒè¯[6000:8000]
â†’ Fold 4: è®­ç»ƒ[0:8000], éªŒè¯[8000:10000]  # æ³¨æ„ï¼šè¿™ä¸outsampleé‡å 
```

---

## å¦‚ä½•é‡æ–°è¿è¡Œå®éªŒ

### æ–¹å¼1ï¼šä½¿ç”¨é»˜è®¤é…ç½®ï¼ˆæ¨èï¼‰

æ‰€æœ‰è„šæœ¬çš„é»˜è®¤é…ç½®å·²æ”¹ä¸º`use_time_series_split=True`ï¼Œç›´æ¥è¿è¡Œå³å¯ï¼š

```bash
# 1. é‡æ–°è®­ç»ƒåŸºçº¿æ¨¡å‹
uv run python src/s02_model_training/train_models.py

# è¾“å‡ºç›®å½•ï¼šresults/baseline_models_timeseries/
```

### æ–¹å¼2ï¼šå¯¹æ¯”ä¸¤ç§åˆ’åˆ†æ–¹å¼

å¦‚æœæƒ³å¯¹æ¯”æ—§æ–¹æ³•å’Œæ–°æ–¹æ³•çš„å·®å¼‚ï¼š

```bash
# æ–¹å¼Aï¼šéšæœºåˆ’åˆ†ï¼ˆæ—§æ–¹æ³•ï¼Œæœ‰æ•°æ®æ³„éœ²ï¼‰
uv run python << 'EOF'
from src.s02_model_training.train_models import BaselineModelTrainer

trainer = BaselineModelTrainer(
    data_path="data/data.csv",
    output_dir="results/baseline_models_random",  # ä¿®æ”¹è¾“å‡ºç›®å½•
    random_state=42,
    n_folds=4
)

# éœ€è¦ä¿®æ”¹DataLoaderå’ŒCrossValidatorçš„è°ƒç”¨å‚æ•°ä¸ºuse_time_series_split=False
trainer.run()
EOF

# æ–¹å¼Bï¼šæ—¶åºåˆ’åˆ†ï¼ˆæ–°æ–¹æ³•ï¼Œæ— æ•°æ®æ³„éœ²ï¼‰
uv run python src/s02_model_training/train_models.py
```

### æ–¹å¼3ï¼šä¿®æ”¹train_models.pyæ‰‹åŠ¨æ§åˆ¶

å¦‚æœéœ€è¦åœ¨åŒä¸€ä¸ªè„šæœ¬ä¸­å¯¹æ¯”ä¸¤ç§æ–¹å¼ï¼Œä¿®æ”¹ `src/s02_model_training/train_models.py`:

```python
# åœ¨ç¬¬63-70è¡Œçš„åˆå§‹åŒ–ä¸­æ·»åŠ å‚æ•°
self.data_loader = DataLoader(
    data_path=data_path,
    target_column="realY",
    test_size=0.2,
    random_state=random_state,
    use_time_series_split=True  # ä¿®æ”¹è¿™é‡Œ: True=æ—¶åº, False=éšæœº
)

# åœ¨ç¬¬70è¡Œçš„åˆå§‹åŒ–ä¸­æ·»åŠ å‚æ•°
self.cv = CrossValidator(
    n_folds=n_folds,
    random_state=random_state,
    use_time_series_split=True  # ä¿®æ”¹è¿™é‡Œ: True=æ—¶åº, False=éšæœº
)
```

---

## é¢„æœŸç»“æœå˜åŒ–

### LightGBMæ€§èƒ½é¢„æœŸ

| æŒ‡æ ‡ | æ—§æ–¹æ³•ï¼ˆæœ‰æ³„éœ²ï¼‰ | æ–°æ–¹æ³•ï¼ˆæ— æ³„éœ²ï¼‰ | é¢„æœŸå˜åŒ– |
|------|----------------|----------------|---------|
| **CVéªŒè¯IC** | 0.557 | ~0.45-0.50 | â¬‡ï¸ ä¸‹é™10-20% |
| **Outsampleæµ‹è¯•IC** | 0.625 | ~0.43-0.48 | â¬‡ï¸ ä¸‹é™20-30% |
| **Outsample vs CV** | +12% (å¼‚å¸¸) | -2% ~ 0% (æ­£å¸¸) | âœ… æ¢å¤æ­£å¸¸ |

### çº¿æ€§æ¨¡å‹æ€§èƒ½é¢„æœŸ

çº¿æ€§æ¨¡å‹å¯¹æ—¶åºæ³„éœ²ä¸æ•æ„Ÿï¼Œé¢„æœŸå˜åŒ–è¾ƒå°ï¼š

| æ¨¡å‹ | æ—§æ–¹æ³•IC | æ–°æ–¹æ³•IC | é¢„æœŸå˜åŒ– |
|------|---------|---------|---------|
| Lasso | 0.241 â†’ 0.213 | ~0.21-0.24 | åŸºæœ¬æŒå¹³ |
| Ridge | 0.240 â†’ 0.223 | ~0.22-0.24 | åŸºæœ¬æŒå¹³ |

---

## æ³¨æ„äº‹é¡¹

### âš ï¸ TimeSeriesSplitçš„ç‰¹æ®Šæ€§

ä½¿ç”¨TimeSeriesSplitæ—¶ï¼Œ**æœ€åä¸€ä¸ªfoldçš„éªŒè¯é›†ä¼šä¸outsampleæµ‹è¯•é›†é‡å **ï¼š

```
æ•°æ®èŒƒå›´: [0, 1, 2, ..., 7999, 8000, ..., 9999]
           â””â”€â”€insample (8000)â”€â”˜  â””â”€outsample (2000)â”€â”˜

TimeSeriesSplit Fold 4:
  è®­ç»ƒé›†: [0, ..., 5999]  (6000ä¸ª)
  éªŒè¯é›†: [6000, ..., 7999]  (2000ä¸ª)

ä½†æ˜¯æˆ‘ä»¬ç°åœ¨ç”¨å…¨éƒ¨insample [0, ..., 7999]è®­ç»ƒï¼Œ
ç„¶ååœ¨outsample [8000, ..., 9999]ä¸Šæµ‹è¯•ã€‚

æ‰€ä»¥ï¼š
- CVçš„æœ€åä¸€ä¸ªfoldéªŒè¯é›† [6000-7999] â‰  outsample [8000-9999]
- æ²¡æœ‰é‡å ï¼Œè¿™æ˜¯åˆç†çš„
```

å®é™…ä¸Šï¼Œç”±äºæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯`insample`çš„å‰80%ï¼ˆ8000ä¸ªæ ·æœ¬ï¼‰è¿›è¡Œäº¤å‰éªŒè¯ï¼Œè€Œoutsampleæ˜¯ç‹¬ç«‹çš„å20%ï¼ˆ2000ä¸ªæ ·æœ¬ï¼‰ï¼Œæ‰€ä»¥**æ²¡æœ‰é‡å é—®é¢˜**ã€‚

### âœ… ä¿®å¤åçš„æ­£å¸¸ç°è±¡

- Outsample IC â‰¤ CV ICï¼ˆç•¥ä½æˆ–æŒå¹³ï¼‰
- æ‰€æœ‰æ¨¡å‹çš„æ³›åŒ–è¡¨ç°æ›´"è¯šå®"
- **æ€§èƒ½ä¸‹é™æ˜¯æ­£å¸¸çš„**ï¼Œå› ä¸ºä¹‹å‰çš„é«˜æ€§èƒ½æ˜¯è™šå‡çš„

---

## éªŒè¯ä¿®å¤æ˜¯å¦æˆåŠŸ

è¿è¡Œå®éªŒåï¼Œæ£€æŸ¥ä»¥ä¸‹å†…å®¹ï¼š

### 1. æ£€æŸ¥æ•°æ®åˆ’åˆ†

```python
import pandas as pd

# è¯»å–æ–°çš„ç»“æœ
loader_log = "..."  # æŸ¥çœ‹è®­ç»ƒæ—¥å¿—

# åº”è¯¥çœ‹åˆ°ï¼š
# âœ“ ä½¿ç”¨æ—¶åºåˆ’åˆ†ï¼ˆé˜²æ­¢æ•°æ®æ³„éœ²ï¼‰
# âœ“ æ ·æœ¬å†…æ•°æ®ç´¢å¼•èŒƒå›´: [0, 7999]
# âœ“ æ ·æœ¬å¤–æ•°æ®ç´¢å¼•èŒƒå›´: [8000, 9999]
```

### 2. æ£€æŸ¥æ€§èƒ½æŒ‡æ ‡

```python
import pandas as pd

# è¯»å–ç»“æœ
cv_results = pd.read_csv("results/baseline_models/cv_results_summary.csv")
out_results = pd.read_csv("results/baseline_models/outsample_results.csv")

# LightGBMçš„outsample ICåº”è¯¥ â‰¤ CV IC
lgb_cv_ic = cv_results[cv_results['model']=='LightGBM']['val_ic_pearson_mean'].values[0]
lgb_out_ic = out_results[out_results['model']=='LightGBM']['ic_pearson'].values[0]

print(f"LightGBM CV IC: {lgb_cv_ic:.4f}")
print(f"LightGBM Outsample IC: {lgb_out_ic:.4f}")
print(f"å·®å¼‚: {((lgb_out_ic - lgb_cv_ic) / lgb_cv_ic * 100):+.2f}%")

# âœ… æ­£å¸¸ï¼šå·®å¼‚åº”è¯¥åœ¨ -5% ~ +2% ä¹‹é—´
# âŒ å¼‚å¸¸ï¼šå¦‚æœå·®å¼‚ > +5%ï¼Œè¯´æ˜ä»æœ‰æ•°æ®æ³„éœ²
```

### 3. å¯¹æ¯”æ–°æ—§ç»“æœ

| æ¨¡å‹ | æ—§æ–¹æ³• Outsample IC | æ–°æ–¹æ³• Outsample IC | å˜åŒ– |
|------|-------------------|-------------------|------|
| LightGBM | 0.625 | ??? | é¢„æœŸâ¬‡ï¸ |
| Lasso | 0.213 | ??? | é¢„æœŸæŒå¹³ |
| Ridge | 0.223 | ??? | é¢„æœŸæŒå¹³ |

---

## åç»­éœ€è¦é‡æ–°è¿è¡Œçš„å®éªŒ

ä¿®å¤æ•°æ®æ³„éœ²åï¼Œä»¥ä¸‹æ‰€æœ‰å®éªŒéƒ½éœ€è¦é‡æ–°è¿è¡Œï¼š

- [x] âœ… `src/s02_model_training/train_models.py` - åŸºçº¿æ¨¡å‹è®­ç»ƒ
- [ ] âš ï¸ `src/s03_hyperparameter_tuning/lightgbm_tuning.py` - LightGBMè°ƒä¼˜
- [ ] âš ï¸ `src/s03_hyperparameter_tuning/lasso_analysis.py` - LASSOåˆ†æ
- [ ] âš ï¸ `src/s04_feature_selection/run_feature_selection.py` - ç‰¹å¾é€‰æ‹©

**å»ºè®®é¡ºåº**ï¼š
1. å…ˆè¿è¡ŒåŸºçº¿æ¨¡å‹ï¼Œç¡®è®¤ä¿®å¤æœ‰æ•ˆ
2. å†è¿è¡Œè¶…å‚æ•°è°ƒä¼˜ï¼ˆåŸºäºæ–°çš„æ­£ç¡®è¯„ä¼°ï¼‰
3. æœ€åè¿è¡Œç‰¹å¾é€‰æ‹©ï¼ˆåŸºäºè°ƒä¼˜åçš„æ¨¡å‹ï¼‰

---

## FAQ

### Q1: ä¸ºä»€ä¹ˆæ€§èƒ½ä¼šä¸‹é™ï¼Ÿ

**A**: ä¹‹å‰çš„é«˜æ€§èƒ½æ˜¯è™šå‡çš„ï¼Œå› ä¸ºå­˜åœ¨æ•°æ®æ³„éœ²ã€‚ä¿®å¤åçš„æ€§èƒ½æ‰æ˜¯çœŸå®çš„æ³›åŒ–èƒ½åŠ›ã€‚

### Q2: çº¿æ€§æ¨¡å‹ä¸ºä»€ä¹ˆå˜åŒ–ä¸å¤§ï¼Ÿ

**A**: çº¿æ€§æ¨¡å‹å¯¹æ—¶åºæ¨¡å¼ä¸æ•æ„Ÿï¼Œæ‰€ä»¥æ•°æ®æ³„éœ²å¯¹å®ƒä»¬å½±å“è¾ƒå°ã€‚LightGBMèƒ½æ•æ‰æ—¶åºæ¨¡å¼ï¼Œæ‰€ä»¥å—æ³„éœ²å½±å“æ›´å¤§ã€‚

### Q3: å¦‚æœæ•°æ®çœŸçš„ä¸æ˜¯æ—¶åºæ€ä¹ˆåŠï¼Ÿ

**A**: å¦‚æœç¡®è®¤æ•°æ®ç¡®å®æ²¡æœ‰æ—¶åºä¾èµ–ï¼ˆéœ€è¦å’¨è¯¢æ•°æ®æä¾›æ–¹ï¼‰ï¼Œå¯ä»¥è®¾ç½®`use_time_series_split=False`æ¢å¤éšæœºåˆ’åˆ†ã€‚ä½†éœ€è¦è§£é‡Šä¸ºä»€ä¹ˆå­˜åœ¨è‡ªç›¸å…³ã€‚

### Q4: ä¿®å¤åçš„ç»“æœè¿˜èƒ½ç”¨å—ï¼Ÿ

**A**: ä¿®å¤åçš„ç»“æœæ‰æ˜¯å¯ä¿¡çš„ï¼è¿™äº›ç»“æœæ‰èƒ½åæ˜ æ¨¡å‹åœ¨çœŸå®åœºæ™¯ä¸‹çš„è¡¨ç°ã€‚

---

**ä¸‹ä¸€æ­¥è¡ŒåŠ¨**: è¿è¡Œ `uv run python src/s02_model_training/train_models.py`

---

*æŒ‡å—ç”Ÿæˆæ—¶é—´: 2025-11-10*
